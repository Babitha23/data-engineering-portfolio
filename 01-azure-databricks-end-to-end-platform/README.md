# UK Energy Intelligence Lakehouse Platform

This repository implements an end-to-end data platform for UK energy analytics, ingesting public energy datasets and transforming them using Azure Data Factory, Azure Databricks, Delta Lake, and Synapse serverless SQL. It demonstrates batch ingestion, medallion architecture (Bronzeâ€“Silverâ€“Gold), and scalable processing suitable for enterprise pipelines.

## Project Overview

This project demonstrates how large, complex public-sector energy datasets can be transformed into analytics-ready data using modern data engineering best practices.

UK government energy datasets are published in Excel formats with:
- Multiple tables per file
- Inconsistent schemas
- Hierarchical headers
- Monthly, quarterly, and annual reporting structures

The goal of this project is to design and implement a scalable Azure Lakehouse platform that:
- Ingests raw energy datasets
- Cleans and standardises them
- Models them into fact and dimension tables
- Makes them ready for analytics, reporting, and BI consumption

## Business Use Case

Energy policy analysts, regulators, and planners require consistent and reliable data to understand:
- How electricity is generated by fuel type
- How supply and demand components change over time
- Trends in consumption across sectors

However, UK energy data is fragmented across multiple Excel-based statistical releases.

This platform enables:
- Centralised energy data storage
- Consistent metrics across datasets
- Faster policy and operational analysis
- Reliable historical comparisons

The curated Gold layer can directly support:
- Energy mix analysis (renewables vs fossil fuels)
- Supply vs demand balancing
- Long-term energy transition insights

## Architecture Overview

The platform follows a modern Azure Lakehouse architecture:

1. Raw energy datasets are ingested from UK Government sources
2. Azure Data Factory orchestrates ingestion into ADLS Gen2 (Bronze)
3. Azure Databricks performs data cleaning and standardisation (Silver)
4. Curated fact and dimension tables are created in the Gold layer
5. Azure Synapse Serverless enables cost-efficient SQL analytics
6. Power BI can be connected directly to the Gold layer for reporting<br>

![Architecture Diagram](docs/ARCHITECTURE.png)

## Datasets Used

All datasets are sourced from GOV.UK Energy Trends and official statistics.

| Dataset | Description | Frequency |
|------|------------|----------|
| ET 5.1 | Electricity generation by fuel type | Monthly |
| ET 5.2 | Electricity supply and demand components | Monthly |

## Data Pipeline & Lakehouse Design

The platform follows a Medallion (Bronzeâ€“Silverâ€“Gold) architecture.

### Bronze Layer
- Raw Excel files
- Stored exactly as received
- No transformations applied

### Silver Layer
- Cleaned and standardised datasets
- Normalised column names and data types
- Hierarchical Excel structures flattened
- Validated for data quality

### Gold Layer
- Analytics-ready fact and dimension tables
- Star schema modelling
- Optimised for SQL and BI consumption

> [!IMPORTANT]
> **[Gold Layer Design](docs/GOLD_LAYER_DESIGN.md)**

## ðŸ“Š Analytics Layer (Synapse Serverless SQL)
The Analytics layer exposes curated Gold tables for reporting and business insights.
Azure Synapse Serverless SQL is used to query the Gold layer directly without data movement, enabling cost-efficient, scalable analytics.

### ðŸ”¹ Purpose of the Analytics Layer
- Enable trend analysis on UK electricity generation, supply, and demand
- Support time-series and seasonal analysis (annual & quarterly)
- Provide BI-ready datasets for Power BI
- Demonstrate strong SQL analytics patterns (CTEs, aggregations, percentages)

### ðŸ§± Gold Tables used and Business use cases
1. **fact_electricity_by_fuel**: Derived from ET5.1 datasets (annual & quarterly)
	- Grain: One row per fuel Ã— generator type Ã— metric Ã— time period
	- Metrics: 
		- Fuel used in electricity generation (Mtoe)
		- Electricity generated by fuel (TWh)
		- Electricity supplied by fuel (TWh)
	- Business use cases:
		- Fuel mix analysis
		- Renewable vs fossil fuel trends
		- Seasonal electricity generation patterns
> [!IMPORTANT]
> - Sample business questions answered by **fact_electricity_by_fuel**:
>	- How has electricity generation by fuel changed over time?
>	- What are the short-term trends in electricity generation?
>	- How much of the UKâ€™s electricity comes from renewables?
>	- What are the dominant fuel sources today?
>	- What percentage of total generation does each fuel contribute?
	
**Refer here for [Sample analytics queries](synapse/sql/analytics/)**
	
2. **fact_electricity_supply_demand**: Derived from ET5.2 datasets (annual & quarterly)
	- Grain: One row per supply/demand component Ã— time period
	- Metric: 
		- Demand or supply of Electricity (GWh)
	- Business use cases:
		- Supply vs demand comparison
		- Electricity imports and exports analysis
		- Net electricity balance
		- Energy security insights
> [!IMPORTANT]
> - Sample business questions answered BY **fact_electricity_supply_demand**:
>	- How do total electricity supply and demand compare year by year?
>	- Is electricity demand increasing or decreasing over time?
>	- How do supply and demand fluctuate across quarters?
>	- How reliant is the UK on electricity imports?
>	- Does the UK produce more electricity than it consumes?
>	- Which components contribute most to electricity supply?

**Refer here for [Sample analytics queries](synapse/sql/analytics/)**

## ðŸ§  Modeling Approach
- Wide Excel-based time-series datasets were normalized into long-format fact tables
- Quarterly columns were dynamically unpivoted using Spark transformations
- Time attributes were extracted and standardized for consistent querying
- Gold tables are optimized for downstream SQL analytics and BI consumption

## Technologies Used
- Azure Data Factory â€“ ingestion orchestration
- Azure Data Lake Storage Gen2 â€“ data lake storage
- Azure Databricks â€“ data transformation and Delta Lake
- Apache Spark (PySpark)
- Delta Lake
- Azure Synapse Serverless SQL â€“ cost-efficient analytics
- GitHub â€“ version control and portfolio hosting

> [!IMPORTANT]
> Rationale for [technology choices](docs/TECHNOLOGY_CHOICES.md)
  
## Key Engineering Challenges Solved
- Ingesting Excel files with multiple logical tables per sheet
- Handling hierarchical headers and null-based grouping
- Supporting quarterly, and annual reporting structures
- Designing reusable Spark transformation functions
- Making Databricks notebooks GitHub-friendly for portfolio review

## How to Run
### Prerequisites
- Azure Subscription
- Databricks workspace
- Storage account with permissions

### Setup
1. Clone the repo
2. Configure secrets in Databricks
3. Run notebooks in order:
   - 01_bronze_to_silver_energy_generation_trends_et5.1
   - 02_bronze_to_silver_energy_supply_demand_trends_et5.2
   - 03_silver_to_gold_energy_trends

### Output
- Silver tables in ADLS
- Gold tables in ADLS
- Gold star schema in Synapse SQL

## Repository Structure

```text
01-azure-databricks-end-to-end-platform/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ datasets.yml
â”œâ”€â”€ notebooks/
â”‚   â”œâ”€â”€ 01_bronze_to_silver_energy_trends_et5.1.ipynb
â”‚   â”œâ”€â”€ 02_bronze_to_silver_energy_trends_et5.2.ipynb
â”‚   â””â”€â”€ 03_silver_to_gold_energy_trends.ipynb
â”œâ”€â”€ synapse/sql/
â”‚   â”œâ”€â”€ analytics/
â”‚   â”œâ”€â”€ create_vw_electricity_by_fuel.sql
â”‚   â””â”€â”€ create_vw_electricity_supply_demand.sql
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ Daily_logs/
Analytics_layer.md
â”‚   â”œâ”€â”€ ARCHITECTURE.png
|   â”œâ”€â”€ DATA_DICTIONARY.md
â”‚   â”œâ”€â”€ GOLD_LAYER_DESIGN.md
|   â”œâ”€â”€ PROJECT_OVERVIEW.md
â”‚   â””â”€â”€ TECHNOLOGY_CHOICES.md
â””â”€â”€ README.md
